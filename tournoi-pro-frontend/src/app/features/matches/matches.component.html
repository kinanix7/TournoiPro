<app-navigation></app-navigation>

<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 mb-0">
          <i class="bi bi-calendar-event me-2"></i>Matches
        </h1>
      </div>
    </div>
  </div>
  
  <!-- Filters -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="bi bi-funnel me-2"></i>Filters
          </h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-3">
              <label for="filterType" class="form-label">Filter Type</label>
              <select 
                id="filterType" 
                class="form-select" 
                [(ngModel)]="selectedFilterType"
                (change)="onFilterTypeChange()">
                <option value="all">All Matches</option>
                <option value="date">Specific Date</option>
                <option value="range">Date Range</option>
                <option value="completed">Completed Only</option>
                <option value="upcoming">Upcoming Only</option>
              </select>
            </div>
            
            <div class="col-md-3" *ngIf="selectedFilterType === 'date'">
              <label for="specificDate" class="form-label">Date</label>
              <input 
                type="date" 
                id="specificDate" 
                class="form-control" 
                [(ngModel)]="specificDate"
                (change)="applyDateFilter()">
            </div>
            
            <div class="col-md-3" *ngIf="selectedFilterType === 'range'">
              <label for="startDate" class="form-label">Start Date</label>
              <input 
                type="date" 
                id="startDate" 
                class="form-control" 
                [(ngModel)]="startDate"
                (change)="applyDateRangeFilter()">
            </div>
            
            <div class="col-md-3" *ngIf="selectedFilterType === 'range'">
              <label for="endDate" class="form-label">End Date</label>
              <input 
                type="date" 
                id="endDate" 
                class="form-control" 
                [(ngModel)]="endDate"
                (change)="applyDateRangeFilter()">
            </div>
            
            <div class="col-md-3">
              <label for="searchTeam" class="form-label">Search Team</label>
              <input 
                type="text" 
                id="searchTeam" 
                class="form-control" 
                placeholder="Enter team name"
                [(ngModel)]="searchTerm"
                (input)="applySearch()">
            </div>
            
            <div class="col-md-3 d-flex align-items-end">
              <button 
                type="button" 
                class="btn btn-outline-secondary" 
                (click)="clearFilters()">
                <i class="bi bi-x-circle me-1"></i>Clear Filters
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Matches List -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            Matches ({{ filteredMatches.length }})
          </h5>
          <div class="d-flex gap-2">
            <button 
              type="button" 
              class="btn btn-sm" 
              [class]="viewMode === 'card' ? 'btn-primary' : 'btn-outline-primary'"
              (click)="viewMode = 'card'">
              <i class="bi bi-grid-3x3-gap"></i>
            </button>
            <button 
              type="button" 
              class="btn btn-sm" 
              [class]="viewMode === 'table' ? 'btn-primary' : 'btn-outline-primary'"
              (click)="viewMode = 'table'">
              <i class="bi bi-list"></i>
            </button>
          </div>
        </div>
        <div class="card-body">
          <!-- Loading State -->
          <div *ngIf="isLoading" class="text-center py-5">
            <div class="spinner-border" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-muted">Loading matches...</p>
          </div>
          
          <!-- No Matches -->
          <div *ngIf="!isLoading && filteredMatches.length === 0" class="text-center py-5 text-muted">
            <i class="bi bi-calendar-x fs-1 d-block mb-3"></i>
            <h4>No matches found</h4>
            <p>{{ getNoMatchesMessage() }}</p>
          </div>
          
          <!-- Card View -->
          <div *ngIf="!isLoading && filteredMatches.length > 0 && viewMode === 'card'" class="row">
            <div *ngFor="let match of filteredMatches" class="col-lg-6 col-xl-4 mb-3">
              <div class="card h-100 match-card" 
                   [class.border-success]="match.termine"
                   [class.border-warning]="!match.termine">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    <i class="bi bi-calendar-event me-1"></i>{{ formatDate(match.date) }}
                  </small>
                  <span class="badge" 
                        [class]="match.termine ? 'bg-success' : 'bg-warning'">
                    {{ match.termine ? 'Completed' : 'Upcoming' }}
                  </span>
                </div>
                <div class="card-body">
                  <div class="text-center mb-3">
                    <h6 class="mb-1">{{ match.heure }}</h6>
                    <small class="text-muted">
                      <i class="bi bi-geo-alt me-1"></i>{{ getCourtName(match) }}
                    </small>
                  </div>
                  
                  <div class="row text-center align-items-center">
                    <div class="col-5">
                      <h6 class="mb-1 fw-bold">{{ getTeamName(match, 1) }}</h6>
                      <span *ngIf="match.termine" class="fs-4 fw-bold"
                            [class]="getScoreClass(match.scoreEquipe1, match.scoreEquipe2)">
                        {{ match.scoreEquipe1 }}
                      </span>
                    </div>
                    <div class="col-2">
                      <span class="text-muted">VS</span>
                    </div>
                    <div class="col-5">
                      <h6 class="mb-1 fw-bold">{{ getTeamName(match, 2) }}</h6>
                      <span *ngIf="match.termine" class="fs-4 fw-bold"
                            [class]="getScoreClass(match.scoreEquipe2, match.scoreEquipe1)">
                        {{ match.scoreEquipe2 }}
                      </span>
                    </div>
                  </div>
                  
                  <div class="mt-3 text-center" *ngIf="match.arbitre">
                    <small class="text-muted">
                      <i class="bi bi-person-badge me-1"></i>Referee: {{ match.arbitre.nom }}
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Table View -->
          <div *ngIf="!isLoading && filteredMatches.length > 0 && viewMode === 'table'" class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Teams</th>
                  <th>Score</th>
                  <th>Court</th>
                  <th>Referee</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let match of filteredMatches" 
                    [class.table-success]="match.termine">
                  <td>{{ formatDate(match.date) }}</td>
                  <td>{{ match.heure }}</td>
                  <td>
                    <div class="d-flex align-items-center">
                      <span class="badge bg-primary me-2">{{ getTeamName(match, 1) }}</span>
                      <span class="text-muted me-2">vs</span>
                      <span class="badge bg-secondary">{{ getTeamName(match, 2) }}</span>
                    </div>
                  </td>
                  <td>
                    <span *ngIf="match.termine">
                      <span class="badge" 
                            [class]="getScoreBadgeClass(match.scoreEquipe1, match.scoreEquipe2)">
                        {{ match.scoreEquipe1 }}
                      </span>
                      <span class="mx-1">-</span>
                      <span class="badge" 
                            [class]="getScoreBadgeClass(match.scoreEquipe2, match.scoreEquipe1)">
                        {{ match.scoreEquipe2 }}
                      </span>
                    </span>
                    <span *ngIf="!match.termine" class="text-muted">-</span>
                  </td>
                  <td>{{ getCourtName(match) }}</td>
                  <td>{{ match.arbitre?.nom || '-' }}</td>
                  <td>
                    <span class="badge" 
                          [class]="match.termine ? 'bg-success' : 'bg-warning'">
                      {{ match.termine ? 'Completed' : 'Upcoming' }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Statistics -->
  <div class="row mt-4">
    <div class="col-md-3">
      <div class="card bg-primary text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="card-title">Total Matches</h6>
              <h3 class="mb-0">{{ allMatches.length }}</h3>
            </div>
            <div class="align-self-center">
              <i class="bi bi-calendar-event fs-2 opacity-75"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="card-title">Completed</h6>
              <h3 class="mb-0">{{ completedMatches.length }}</h3>
            </div>
            <div class="align-self-center">
              <i class="bi bi-check-circle fs-2 opacity-75"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="card-title">Upcoming</h6>
              <h3 class="mb-0">{{ upcomingMatches.length }}</h3>
            </div>
            <div class="align-self-center">
              <i class="bi bi-clock fs-2 opacity-75"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="card-title">Filtered Results</h6>
              <h3 class="mb-0">{{ filteredMatches.length }}</h3>
            </div>
            <div class="align-self-center">
              <i class="bi bi-funnel fs-2 opacity-75"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>